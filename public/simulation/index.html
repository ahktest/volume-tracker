<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Simulation Koşullar</title>
  <div class="subtitle">Güncel strateji gruplarının toplam ve ortalama PnL performansı</div>
  <link rel="stylesheet" href="style.css">
  
</head>
<body>
  <div class="container">
    <h1>Simulasyon Özeti</h1>
    <div id="grid" class="grid"></div>
  </div>

  <script>
    async function loadSummary(){
      try{
        const res = await fetch('/api/sim/summary', { headers: { 'Accept': 'application/json' }});
        if(!res.ok){
          throw new Error('API ' + res.status);
        }
        const data = await res.json();

        const cardsEl = document.getElementById('cards');
        cardsEl.innerHTML = '';

        data.forEach(item => {
          // Backend’den gelebilecek string/nullları güvenle sayıya çevir
          const trades = Number(item.trades ?? 0);
          const total = Number(item.total_pnl ?? 0);
          const avg = trades > 0
            ? Number(item.avg_pnl ?? (total / trades))
            : Number(item.avg_pnl ?? 0);

          const avgFmt = (isFinite(avg) ? avg : 0).toFixed(2);
          const totalFmt = (isFinite(total) ? total : 0).toFixed(2);
          const pnlClass = (avg >= 0 ? 'pnl-pos' : 'pnl-neg');

          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>${item.position || 'Bilinmeyen'}
              <span class="badge">${trades} işlem</span>
            </h3>
            <div class="meta"><strong>Toplam:</strong> ${totalFmt}%</div>
            <div class="meta"><strong>Ortalama PnL:</strong> <span class="${pnlClass}">${avgFmt}%</span></div>
          `;
          cardsEl.appendChild(card);
        });
      }catch(err){
        console.error('Özet yüklenemedi:', err);
        const cardsEl = document.getElementById('cards');
        cardsEl.innerHTML = `<div class="card"><h3>Hata</h3><div class="meta">Özet yüklenemedi. Daha sonra tekrar deneyin.</div></div>`;
      }
    }

    loadSummary();
  </script>
</body>
</html>