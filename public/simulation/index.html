<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simülasyon Koşullar</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="header">
    <h1 class="title">Simülasyon Özeti</h1>
    <div class="subtitle">Güncel strateji gruplarının toplam ve ortalama PnL performansı</div>
  </header>

  <!-- JS burayı dolduracak -->
  <main class="grid" id="cards"></main>

  <script>
    async function loadSummary(){
      try{
        const res = await fetch('/api/sim/summary', { headers: { 'Accept': 'application/json' }});
        if(!res.ok) throw new Error('API ' + res.status);

        const data = await res.json();
        const cardsEl = document.getElementById('cards');
        cardsEl.innerHTML = '';

        data.forEach(item => {
          const trades = Number(item.trades ?? 0);
          const total = Number(item.total_pnl ?? 0);
          const avg = trades > 0
            ? Number(item.avg_pnl ?? (total / trades))
            : Number(item.avg_pnl ?? 0);

          const avgFmt = (isFinite(avg) ? avg : 0).toFixed(2);
          const totalFmt = (isFinite(total) ? total : 0).toFixed(2);
          const pnlClass = (avg >= 0 ? 'pnl-pos' : 'pnl-neg');

          const posQS = encodeURIComponent(item.position || '');
const href = `list.html?position=${posQS}`;

const card = document.createElement('a');
        
          ccard.className = 'card card-link';
card.href = href;
          card.innerHTML = `
            <h3>${item.position || 'Bilinmeyen'}
              <span class="badge">${trades} işlem</span>
            </h3>
            <div class="meta"><strong>Toplam:</strong> ${totalFmt}%</div>
            <div class="meta"><strong>Ortalama PnL:</strong> <span class="${pnlClass}">${avgFmt}%</span></div>
          `;
          cardsEl.appendChild(card);
        });
      }catch(err){
        console.error('Özet yüklenemedi:', err);
        const cardsEl = document.getElementById('cards');
        if (cardsEl) {
          cardsEl.innerHTML = `<div class="card"><h3>Hata</h3><div class="meta">Özet yüklenemedi. Daha sonra tekrar deneyin.</div></div>`;
        }
      }
    }

    loadSummary();
  </script>
</body>
</html>